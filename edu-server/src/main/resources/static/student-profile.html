<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>学生信息 - EduPlatform</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
    <link rel="stylesheet" href="common.css">

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#165DFF',
                        secondary: '#36CFC9',
                        accent: '#722ED1',
                        success: '#52C41A',
                        warning: '#FAAD14',
                        danger: '#FF4D4F',
                        dark: '#1D2129',
                        light: '#F2F3F5'
                    },
                    fontFamily: {
                        inter: ['Inter', 'system-ui', 'sans-serif'],
                    },
                },
            }
        }
    </script>
</head>
<body class="font-inter bg-gray-50 text-dark">
<!-- 导航栏 -->
<header id="navbar" class="fixed w-full bg-white/90 backdrop-blur-sm shadow-sm z-50 transition-all duration-300">
    <div class="container mx-auto px-4 sm:px-6 lg:px-8">
        <div class="flex justify-between items-center h-16">
            <div class="flex items-center">
                <a href="index.html" class="flex items-center">
                    <i class="fa fa-graduation-cap text-primary text-2xl mr-2"></i>
                    <span class="text-xl font-bold text-primary">EduPlatform</span>
                </a>
            </div>

            <div class="flex items-center space-x-4">
                <a href="index.html" class="text-gray-600 hover:text-primary font-medium transition-colors">返回首页</a>
            </div>
        </div>
    </div>
</header>

<main class="pt-16 min-h-screen">
    <section class="py-16">
        <div class="container mx-auto px-4 sm:px-6 lg:px-8">
            <div class="max-w-2xl mx-auto bg-white rounded-xl shadow-sm p-8">
                <h2 class="text-2xl font-bold mb-6 text-center">完善学生信息</h2>

                <!-- 学生信息展示区 -->
                <form id="studentProfileForm">
                    <div class="mb-5">
                        <label class="block text-gray-700 mb-2">姓名</label>
                        <div id="studentNameDisplay" class="w-full px-4 py-2 border border-gray-300 rounded-md bg-gray-50">
                            <!-- 学生姓名将在这里显示 -->
                        </div>
                    </div>

                    <div class="mb-5">
                        <label class="block text-gray-700 mb-2">学校</label>
                        <div id="studentClassDisplay" class="w-full px-4 py-2 border border-gray-300 rounded-md bg-gray-50">
                            <!-- 学生学号将在这里显示 -->
                        </div>
                    </div>

                    <div class="mb-5">
                        <label class="block text-gray-700 mb-2">年级</label>
                        <div id="studentGradeDisplay" class="w-full px-4 py-2 border border-gray-300 rounded-md bg-gray-50">
                            <!-- 学生年级将在这里显示 -->
                        </div>
                    </div>

                    <div class="mb-5">
                        <label class="block text-gray-700 mb-2">个人简介</label>
                        <div id="studentDescDisplay" class="w-full px-4 py-2 border border-gray-300 rounded-md bg-gray-50 min-h-[100px]">
                            <!-- 学生简介将在这里显示 -->
                        </div>
                    </div>
                </form>

                <!-- 学生信息编辑区 -->
                <form id="studentProfileNewForm">
                    <div class="mb-5">
                        <label class="block text-gray-700 mb-2">姓名</label>
                        <input type="text" id="studentNameNewInput" class="w-full px-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary/50 focus:border-primary" placeholder="请输入姓名">
                    </div>

                    <div class="mb-5">
                        <label class="block text-gray-700 mb-2">学校</label>
                        <input type="text" id="studentClassNewInput" class="w-full px-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary/50 focus:border-primary" placeholder="请输入学号" readonly>
                    </div>

                    <div class="mb-5">
                        <label class="block text-gray-700 mb-2">年级</label>
                        <input type="text" id="studentGradeNewInput" class="w-full px-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary/50 focus:border-primary" placeholder="请输入年级（如：2023级）">
                    </div>

                    <div class="mb-5">
                        <label class="block text-gray-700 mb-2">个人简介</label>
                        <textarea id="studentDescNewInput" class="w-full px-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary/50 focus:border-primary" rows="4" placeholder="请输入个人简介"></textarea>
                    </div>

                    <div class="flex justify-center space-x-4 mt-8">
                        <button type="button" onclick="history.back()" class="px-6 py-2 border border-gray-300 text-gray-700 rounded-md hover:bg-gray-50 transition-colors">返回</button>
                        <button type="submit" class="px-6 py-2 bg-primary text-white font-medium rounded-md hover:bg-primary/90 transition-colors">保存信息</button>
                    </div>
                </form>
            </div>
        </div>
    </section>
</main>

<footer class="bg-dark text-white py-8">
    <div class="container mx-auto px-4 sm:px-6 lg:px-8 text-center">
        <p class="text-gray-400">© 2023 EduPlatform. 保留所有权利。</p>
    </div>
</footer>

<script>
    // 页面加载时获取并填充学生信息
    window.addEventListener('DOMContentLoaded', function() {
        fetchStudentInfo();
    });

    // 获取学生信息
    async function fetchStudentInfo() {
        try {
            const response = await fetch('/api/student/getStudentInfo', {
                method: 'GET',
                headers: {
                    'Authorization': 'Bearer ' + localStorage.getItem('token'),
                    'Content-Type': 'application/json'
                }
            });

            const result = await response.json();
            if (response.ok && result.code === 200) {
                // 填充展示区信息
                document.getElementById('studentNameDisplay').textContent = result.data.realName || '未填写';
                document.getElementById('studentClassDisplay').textContent = result.data.studentNo || '未分配';
                document.getElementById('studentGradeDisplay').textContent = result.data.grade || '未填写';
                document.getElementById('studentDescDisplay').textContent = result.data.introduction || '未填写';

            } else {
                console.error('获取学生信息失败:', result.msg);
            }
        } catch (error) {
            console.error('获取学生信息时发生错误:', error);
        }
    }

    // 表单提交处理
    document.getElementById('studentProfileNewForm').addEventListener('submit', async function(e) {
        e.preventDefault();

        // 收集表单数据
        const formData = {
            realName: document.getElementById('studentNameNewInput').value,
            class: document.getElementById('studentClassNewInput').value,
            grade: document.getElementById('studentGradeNewInput').value,
            introduction: document.getElementById('studentDescNewInput').value
        };

        try {
            const response = await fetch('/api/student/update', {
                method: 'PUT',
                headers: {
                    'Authorization': 'Bearer ' + localStorage.getItem('token'),
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(formData)
            });

            const result = await response.json();

            if (response.ok && result.code === 200) {
                alert('学生信息保存成功！');
                window.location.href = 'index.html';
            } else {
                alert('保存失败: ' + result.msg);
            }
        } catch (error) {
            console.error('保存学生信息时发生错误:', error);
            alert('网络错误，保存失败');
        }
    });
</script>
</body>
</html>